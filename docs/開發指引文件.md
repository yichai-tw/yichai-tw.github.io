# å¯µç‰©å¥åº·å¿«å ± - å‰©é¤˜é–‹ç™¼æŒ‡å¼•

## ğŸ“‹ ç›®å‰é€²åº¦ç¸½è¦½

âœ… **å·²å®Œæˆ**ï¼š
1. `health-report.html` - ä¸»é é¢èˆ‡è¡¨å–®
2. `health-guidelines.json` - å¥åº·æŒ‡å¼•è³‡æ–™åº«
3. `health-calculator.js` - æ ¸å¿ƒè¨ˆç®—é‚è¼¯
4. `health-report-generator.js` - Canvas åœ–ç‰‡ç”Ÿæˆå™¨ï¼ˆæ ¸å¿ƒï¼‰
5. `health-report-ui.js` - è¡¨å–®äº’å‹•æ§åˆ¶

ğŸ‰ **é–‹ç™¼å®Œæˆ**ï¼šæ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å·²å…¨æ•¸å¯¦ä½œä¸¦é€šéåˆæ­¥æ¸¬è©¦ã€‚

---

## ğŸ¨ æª”æ¡ˆ 1ï¼šhealth-report-generator.js

### åŠŸèƒ½è·è²¬
è² è²¬å°‡è¨ˆç®—çµæœç¹ªè£½æˆ 1080Ã—1440 çš„ PNG åœ–ç‰‡ï¼Œä½¿ç”¨ç´” Canvas API å®Œæˆæ‰€æœ‰ç¹ªåœ–ã€‚

### æ ¸å¿ƒé¡åˆ¥è¨­è¨ˆ

```javascript
class PetHealthReportGenerator {
    constructor(reportData) {
        this.data = reportData;  // ä¾†è‡ª healthCalculator.generateHealthReport()
        this.canvas = document.createElement('canvas');
        this.ctx = this.canvas.getContext('2d');
        this.canvas.width = 1080;
        this.canvas.height = 1440;
    }
}
```

### å¿…é ˆå¯¦ä½œçš„æ–¹æ³•

#### 1. ä¸»è¦ç”Ÿæˆæµç¨‹
```javascript
async generate() {
    await this.loadAssets();      // è¼‰å…¥å­—é«”ã€Logoã€åœ–ç¤º
    this.drawBackground();         // ç¹ªè£½æ¼¸å±¤èƒŒæ™¯
    this.drawHeader();             // é ‚éƒ¨ï¼šLogo + æ¨™é¡Œ
    this.drawAgeCard();            // äººé¡å¹´é½¡å¡ç‰‡
    this.drawStageCard();          // ç”Ÿå‘½éšæ®µå¡ç‰‡
    this.drawBodyConditionCard();  // é«”æ³è©•ä¼°å¡ç‰‡ï¼ˆå¦‚æœ‰é«”é‡ï¼‰
    this.drawNutritionCard();      // é£²é£Ÿå»ºè­°å¡ç‰‡
    this.drawHealthTipsCard();     // å¥åº·æé†’å¡ç‰‡
    await this.drawFooter();       // åº•éƒ¨ï¼šé–€å¸‚è³‡è¨Š + QR Code
    return this.canvas;
}
```

#### 2. è¼”åŠ©ç¹ªåœ–æ–¹æ³•
```javascript
// ç¹ªè£½åœ“è§’çŸ©å½¢å¡ç‰‡
drawRoundedCard(x, y, width, height, radius, fillColor) {
    this.ctx.fillStyle = fillColor;
    this.ctx.beginPath();
    this.ctx.roundRect(x, y, width, height, radius);
    this.ctx.fill();
}

// ç¹ªè£½å¸¶é™°å½±çš„æ–‡å­—
drawTextWithShadow(text, x, y, fontSize, color) {
    this.ctx.shadowColor = 'rgba(0,0,0,0.1)';
    this.ctx.shadowBlur = 4;
    this.ctx.font = `${fontSize}px "Noto Sans TC"`;
    this.ctx.fillStyle = color;
    this.ctx.fillText(text, x, y);
    this.ctx.shadowColor = 'transparent';
}

// ä¸­æ–‡è‡ªå‹•æ›è¡Œï¼ˆé‡è¦ï¼ï¼‰
drawMultilineText(text, x, y, maxWidth, lineHeight) {
    const chars = text.split('');
    let line = '';
    let currentY = y;
    
    for (let char of chars) {
        const testLine = line + char;
        const metrics = this.ctx.measureText(testLine);
        
        if (metrics.width > maxWidth && line !== '') {
            this.ctx.fillText(line, x, currentY);
            line = char;
            currentY += lineHeight;
        } else {
            line = testLine;
        }
    }
    this.ctx.fillText(line, x, currentY);
}
```

#### 3. è³‡ç”¢è¼‰å…¥
```javascript
async loadAssets() {
    // ç­‰å¾…å­—é«”è¼‰å…¥
    await document.fonts.ready;
    
    // è¼‰å…¥ Logo
    this.logo = await this.loadImage('assets/images/yichai-petshop-logo.png');
}

loadImage(src) {
    return new Promise((resolve, reject) => {
        const img = new Image();
        img.onload = () => resolve(img);
        img.onerror = reject;
        img.src = src;
    });
}
```

#### 4. QR Code æ•´åˆ
```javascript
async drawQRCode(url, x, y, size) {
    const qrContainer = document.createElement('div');
    qrContainer.style.display = 'none';
    document.body.appendChild(qrContainer);
    
    new QRCode(qrContainer, {
        text: url,
        width: size,
        height: size,
        colorDark: '#000000',
        colorLight: '#ffffff'
    });
    
    await new Promise(resolve => setTimeout(resolve, 200));
    
    const qrImg = qrContainer.querySelector('img');
    this.ctx.drawImage(qrImg, x, y, size, size);
    
    document.body.removeChild(qrContainer);
}
```

#### 5. åŒ¯å‡ºåŠŸèƒ½
```javascript
async toBlob() {
    return new Promise((resolve) => {
        this.canvas.toBlob(resolve, 'image/png', 0.9);
    });
}

async toDataURL() {
    return this.canvas.toDataURL('image/png', 0.9);
}
```

### ç‰ˆé¢é…ç½®å»ºè­°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” 0
â”‚ ğŸ¨ æ¼¸å±¤èƒŒæ™¯ (#FFF9F0 â†’ #F0F8FF)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ 50
â”‚ Logo (100Ã—100)  | æ¨™é¡Œæ–‡å­—           â”‚
â”‚                 | ç”Ÿæˆæ—¥æœŸ           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ 200
â”‚ ğŸ“Š äººé¡å¹´é½¡å¡ç‰‡ (ç™½åº•åœ“è§’)           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ± ç›¸ç•¶æ–¼äººé¡ 32 æ­²               â”‚ â”‚
â”‚ â”‚ è™•æ–¼äººç”Ÿé»ƒé‡‘æ™‚æœŸ                  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ 450
â”‚ ğŸ“‹ ç”Ÿå‘½éšæ®µå¡ç‰‡                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ æˆå¹´æœŸ (2-7 æ­²)                   â”‚ â”‚
â”‚ â”‚ å»ºè­°æ¯å¹´å¥æª¢ä¸€æ¬¡                  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ 650
â”‚ âš–ï¸ é«”æ³è©•ä¼°å¡ç‰‡ï¼ˆå¦‚æœ‰é«”é‡è³‡æ–™ï¼‰      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ 850
â”‚ ğŸ² é£²é£Ÿå»ºè­°å¡ç‰‡                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ æ¯æ—¥ç†±é‡ï¼š235 kcal                â”‚ â”‚
â”‚ â”‚ ä¹¾ç³§ç´„ï¼š67 g                      â”‚ â”‚
â”‚ â”‚ é£²æ°´ï¼š210 ml                      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ 1050
â”‚ ğŸ’Š å¥åº·æé†’å¡ç‰‡ï¼ˆ4-5 æ¢æé†’ï¼‰        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ 1250
â”‚ ğŸ“ é–€å¸‚è³‡è¨Š + QR Code (120Ã—120)      â”‚
â”‚ å…è²¬è²æ˜ï¼ˆå°å­—ï¼‰                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ 1440
```

### è‰²å½©é…ç½®
- **èƒŒæ™¯æ¼¸å±¤**ï¼š`#FFF9F0` â†’ `#F0F8FF`
- **å¡ç‰‡åº•è‰²**ï¼š`#FFFFFF`ï¼ˆç™½è‰²ï¼‰
- **å“ç‰Œæ©™è‰²**ï¼š`#DF7621`ï¼ˆæ¨™é¡Œã€é‡é»ï¼‰
- **æ·±ç°æ–‡å­—**ï¼š`#333333`
- **æ·ºç°æ–‡å­—**ï¼š`#666666`
- **é™°å½±**ï¼š`rgba(0,0,0,0.1)`

---

## ğŸ® æª”æ¡ˆ 2ï¼šhealth-report-ui.js

### åŠŸèƒ½è·è²¬
è² è²¬è¡¨å–®äº’å‹•ã€æ­¥é©Ÿåˆ‡æ›ã€è³‡æ–™é©—è­‰ã€å ±å‘Šç”Ÿæˆè§¸ç™¼ã€‚

### æ ¸å¿ƒåŠŸèƒ½å¯¦ä½œ

#### 1. å…¨åŸŸè®Šæ•¸
```javascript
let selectedPetType = null;
let currentStep = 1;
let generatedReport = null;
```

#### 2. å‹•ç‰©ç¨®é¡é¸æ“‡
```javascript
function selectPetType(petType) {
    selectedPetType = petType;
    
    // æ›´æ–°æŒ‰éˆ•æ¨£å¼
    document.querySelectorAll('.pet-button').forEach(btn => {
        btn.classList.remove('selected');
    });
    document.querySelector(`[data-pet-type="${petType}"]`).classList.add('selected');
    
    // æ›´æ–°é«”é‡æç¤º
    updateWeightHint(petType);
    
    // é¡¯ç¤º/éš±è—ç‹—ç‹—é«”å‹é¸é …
    document.getElementById('dogSizeSection').style.display = 
        petType === 'dog' ? 'block' : 'none';
    
    // è‡ªå‹•è·³è½‰åˆ°æ­¥é©Ÿ 2
    setTimeout(() => goToStep2(), 500);
}
```

#### 3. æ­¥é©Ÿåˆ‡æ›
```javascript
function goToStep2() {
    document.getElementById('step1').style.display = 'none';
    document.getElementById('step2').style.display = 'block';
    
    updateStepIndicator(2);
}

function backToStep1() {
    document.getElementById('step2').style.display = 'none';
    document.getElementById('step1').style.display = 'block';
    
    updateStepIndicator(1);
}

function updateStepIndicator(step) {
    for (let i = 1; i <= 3; i++) {
        const indicator = document.getElementById(`step${i}Indicator`);
        indicator.classList.remove('active', 'completed');
        
        if (i < step) {
            indicator.classList.add('completed');
        } else if (i === step) {
            indicator.classList.add('active');
        }
    }
}
```

#### 4. è¡¨å–®æäº¤è™•ç†
```javascript
document.getElementById('petDataForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    // é©—è­‰å¿…å¡«æ¬„ä½
    if (!validateForm()) {
        return;
    }
    
    // æ”¶é›†è¡¨å–®è³‡æ–™
    const formData = collectFormData();
    
    // é¡¯ç¤ºè¼‰å…¥å‹•ç•«
    showLoading();
    
    try {
        // ç”Ÿæˆå ±å‘Šè³‡æ–™
        const reportData = healthCalculator.generateHealthReport(formData);
        
        // ç”Ÿæˆåœ–ç‰‡
        const generator = new PetHealthReportGenerator(reportData);
        await generator.generate();
        
        generatedReport = generator;
        
        // é¡¯ç¤ºå ±å‘Š
        showReport();
        
    } catch (error) {
        console.error('ç”Ÿæˆå ±å‘Šå¤±æ•—:', error);
        alert('å ±å‘Šç”Ÿæˆå¤±æ•—ï¼Œè«‹é‡è©¦');
    } finally {
        hideLoading();
    }
});
```

#### 5. è¡¨å–®é©—è­‰
```javascript
function validateForm() {
    const ageInputType = document.querySelector('input[name="ageInputType"]:checked').value;
    
    if (ageInputType === 'birthdate') {
        const birthdate = document.getElementById('birthdate').value;
        if (!birthdate) {
            alert('è«‹é¸æ“‡å‡ºç”Ÿæ—¥æœŸ');
            return false;
        }
    } else {
        const years = document.getElementById('ageYears').value;
        const months = document.getElementById('ageMonths').value;
        if (!years && !months) {
            alert('è«‹è¼¸å…¥å¹´é½¡');
            return false;
        }
    }
    
    // ç‹—ç‹—å¿…é ˆé¸æ“‡é«”å‹
    if (selectedPetType === 'dog') {
        const dogSize = document.querySelector('input[name="dogSize"]:checked');
        if (!dogSize) {
            alert('è«‹é¸æ“‡ç‹—ç‹—é«”å‹');
            return false;
        }
    }
    
    return true;
}
```

#### 6. åˆ†äº«èˆ‡ä¸‹è¼‰
```javascript
async function shareReport() {
    const blob = await generatedReport.toBlob();
    const file = new File([blob], 'pet-health-report.png', { type: 'image/png' });
    
    if (navigator.share && navigator.canShare({ files: [file] })) {
        try {
            await navigator.share({
                title: 'æ¯›å­©å¥åº·å¿«å ±',
                text: 'æˆ‘å‰›ç”Ÿæˆäº†å¯µç‰©çš„å¥åº·å ±å‘Šï¼',
                files: [file]
            });
        } catch (err) {
            downloadReport();
        }
    } else {
        downloadReport();
    }
}

async function downloadReport() {
    const blob = await generatedReport.toBlob();
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `å¯µç‰©å¥åº·å¿«å ±_${new Date().toLocaleDateString()}.png`;
    a.click();
    URL.revokeObjectURL(url);
}

function resetForm() {
    location.reload();
}
```

### è¼”åŠ©åŠŸèƒ½

```javascript
// åˆ‡æ›å¹´é½¡è¼¸å…¥æ–¹å¼
function toggleAgeInput() {
    const type = document.querySelector('input[name="ageInputType"]:checked').value;
    document.getElementById('birthdateInput').style.display = 
        type === 'birthdate' ? 'block' : 'none';
    document.getElementById('ageInput').style.display = 
        type === 'age' ? 'block' : 'none';
}

// æ›´æ–°é«”é‡æç¤º
function updateWeightHint(petType) {
    const hints = {
        cat: 'ä¸€èˆ¬æˆè²“ï¼š3-5 kg',
        dog: 'ä¾é«”å‹è€Œç•°ï¼š2-70 kg',
        rabbit: 'ä¸€èˆ¬æˆå…”ï¼š1.5-3.5 kg',
        hamster: 'å€‰é¼ ï¼š30-200 g'
    };
    document.getElementById('weightHint').textContent = hints[petType] || '';
}

// æ”¶é›†è¡¨å–®è³‡æ–™
function collectFormData() {
    const ageInputType = document.querySelector('input[name="ageInputType"]:checked').value;
    const weight = parseFloat(document.getElementById('weight').value);
    const weightUnit = document.getElementById('weightUnit').value;
    
    return {
        petType: selectedPetType,
        petName: document.getElementById('petName').value || null,
        birthdate: ageInputType === 'birthdate' ? 
            document.getElementById('birthdate').value : null,
        ageYears: ageInputType === 'age' ? 
            parseInt(document.getElementById('ageYears').value) || 0 : null,
        ageMonths: ageInputType === 'age' ? 
            parseInt(document.getElementById('ageMonths').value) || 0 : null,
        weight: weight ? (weightUnit === 'g' ? weight / 1000 : weight) : null,
        dogSize: selectedPetType === 'dog' ? 
            document.querySelector('input[name="dogSize"]:checked')?.value : null
    };
}
```

---

## ğŸš€ æ•´åˆæ¸¬è©¦æª¢æŸ¥æ¸…å–®

å®Œæˆå¾Œè«‹ä¾åºæ¸¬è©¦ï¼š

1. âœ… é¸æ“‡å‹•ç‰©ç¨®é¡ â†’ è‡ªå‹•è·³è½‰æ­¥é©Ÿ 2
2. âœ… ç‹—ç‹—é¡¯ç¤ºé«”å‹é¸é …ï¼Œå…¶ä»–å‹•ç‰©ä¸é¡¯ç¤º
3. âœ… åˆ‡æ›å¹´é½¡è¼¸å…¥æ–¹å¼ï¼ˆå‡ºç”Ÿæ—¥æœŸ/ç›´æ¥è¼¸å…¥ï¼‰
4. âœ… æäº¤è¡¨å–® â†’ é¡¯ç¤ºè¼‰å…¥å‹•ç•« â†’ ç”Ÿæˆå ±å‘Š
5. âœ… Canvas æ­£ç¢ºé¡¯ç¤ºæ‰€æœ‰è³‡è¨Š
6. âœ… åˆ†äº«åŠŸèƒ½ï¼ˆæ‰‹æ©Ÿæ¸¬è©¦ Web Share APIï¼‰
7. âœ… ä¸‹è¼‰ PNG æª”æ¡ˆ
8. âœ… é‡æ–°æ¸¬è©¦æŒ‰éˆ•æ­£å¸¸é‹ä½œ

---

## ğŸ“¦ æœ€çµ‚æª”æ¡ˆçµæ§‹

```
ğŸ“ data
â””â”€â”€ ğŸ“‹ health-guidelines.json

ğŸ“ assets
â”œâ”€â”€ ğŸ“‚ js
â”‚   â”œâ”€â”€ ğŸŸ¨ health-calculator.js
â”‚   â”œâ”€â”€ ğŸŸ¨ health-report-generator.js
â”‚   â””â”€â”€ ğŸŸ¨ health-report-ui.js
â””â”€â”€ ğŸ“‚ images
    â””â”€â”€ ğŸ–¼ï¸ yichai-petshop-logo.png

ğŸŒ health-report.html
```

---

é–‹ç™¼å®Œæˆå¾Œï¼Œè¨˜å¾—åœ¨ `index.html` çš„å°èˆªåˆ—åŠ å…¥æ­¤å·¥å…·çš„é€£çµï¼Œè®“ä½¿ç”¨è€…èƒ½è¼•é¬†æ‰¾åˆ°ï¼