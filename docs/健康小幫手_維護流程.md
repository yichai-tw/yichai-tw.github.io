# 健康小幫手 — 維護與部署流程

本文件說明如何維護專案中與「健康小幫手 / 產生器」相關的資料與腳本，包含何時執行、如何驗證、以及還原流程。

一覽
- Canonical 資料：`data/health-guidelines.json`。
- 來源 CSV（人類可編輯）：`docs/health_conditions.csv`、`docs/health_life_stages.csv`、`docs/pet_breeds.csv`。
- 前端快速載入：每種動物的 runtime JSON 存放於 `data/guidelines_{species}.json`。
- 中繼檔：`data/temp_*.json`（可安全刪除；會由腳本重建）。

基本工作流程（當你有資料更新）
1. 更新 CSV：由內容編輯者修改 `docs/*.csv`。
2. 生成 JSON：在專案根目錄中啟用 venv 後執行：

```powershell
& .venv\Scripts\python.exe scripts/update_health_json.py --in-dir docs --out-dir data
```

   - 這會依照 CSV 產生/更新 `data/health-guidelines.json`（canonical）與 `data/temp_*.json` 中繼檔。
3. 拆分與同步：如果需要每種動物的 runtime JSON，可執行：

```powershell
& .venv\Scripts\python.exe scripts/convert_health_data.py --out-dir data
```

   - 此腳本會產生 `data/guidelines_{species}.json` 供前端載入。
4. 清理中繼檔（選擇性）：使用已提供的清理腳本把舊的非-temp 中繼檔移入 `data/.trash/`（安全還原）：

```powershell
& .venv\Scripts\python.exe scripts/cleanup_intermediate_files.py --data-dir data --dry-run
& .venv\Scripts\python.exe scripts/cleanup_intermediate_files.py --data-dir data --delete --yes
```

驗證
- 本地快速驗證：打開 `news/` 或相關頁面或使用簡單的 HTTP server 測試前端是否能載入 `data/guidelines_*.json`。若前端使用快取，請清除快取或強制重新整理。
- 單元檢查：檢查 `data/health-guidelines.json` 中是否包含 `common` 與各 species 的必要欄位（例如 `conditions`, `life_stages`, `breeds`）。

版本管理與提交建議
- 每次更新資料後，伴隨腳本執行結果提交：CSV（`docs/*.csv`）與 canonical JSON（`data/health-guidelines.json`）。
- 不要把 `data/temp_*.json` 提交到版本庫；若你保留歷史，請把它們加入 `.gitignore`。

回滾（Restore）
- 若誤刪或轉換出錯，從 `data/.trash/<timestamp>/` 還原檔案，或從 git history 恢復已提交的 `data/health-guidelines.json`。

自動化想法（未實作）
- 可加入 CI 步驟：當 `docs/*.csv` 有變更時，自動在 CI 中執行 `update_health_json.py` 並驗證 JSON 結構，再以 review artfacts 的方式產生 `guidelines_{species}.json`。

聯絡與注意事項
- 若有資料欄位改動（schema change），請同時更新 `scripts/` 中的對應解析邏輯並記錄在本文件中。

-- 結束 --
